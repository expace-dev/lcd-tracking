{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block body %}
  {# ===== Vue d’ensemble ===== #}
  <section class="section">
    <div class="container">
      <header class="section-header">
        <h2>Vue d’ensemble</h2>
      </header>

      <div class="dashboard-stats columns">
        <div class="card stat-card">
          <div class="stat-card__value">{{ propertiesCount }}</div>
          <div class="stat-card__label">Logements</div>
        </div>

        <div class="card stat-card">
          <div class="stat-card__value">{{ interventionsCount }}</div>
          <div class="stat-card__label">Interventions (14 jours)</div>
        </div>

        <div class="card stat-card {% if nonConformCount > 0 %}stat-card--alert{% endif %}">
          <div class="stat-card__value">{{ nonConformCount }}</div>
          <div class="stat-card__label">Non conformes</div>
        </div>
      </div>
    </div>
  </section>

  {# ===== Logements ===== #}
  <section class="section">
    <div class="container">
      <header class="section-header">
        <h2>Logements</h2>
      </header>

      <div class="stack">
        {% for property in properties %}
          {% set last = lastInterventions[property.id] ?? null %}

          <div class="card property-card">
            <h3 class="property-card__title">{{ property.name }}</h3>

            {% if last %}
              <p class="property-card__meta subtle">
                Dernière intervention : {{ last.businessDate|date('d/m/Y') }}
              </p>

              <div class="property-card__actions">
                <a class="btn btn-secondary"
                   href="{{ path('owner_intervention_show', { id: last.id }) }}">
                  Voir le détail
                </a>

                {% if last.isConform %}
                  <span class="badge badge--success">Conforme</span>
                {% else %}
                  <span class="badge badge--warning">Non conforme</span>
                {% endif %}
              </div>
            {% else %}
              <p class="property-card__meta subtle">Aucune intervention</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock %}
